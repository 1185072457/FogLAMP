#!/bin/sh

if [ `pg_status | grep -c "server is running"` -gt 0 ]; then

  echo "It looks like the FogLAMP Storage Layer is already running."

else

  echo -n "Starting the FogLAMP Storage Layer, please wait..."
  /usr/local/pgsql/bin/pg_ctl -w -D /usr/local/pgsql/data start > /dev/null

  cycle=30
  while [ "$cycle" -gt 0 ]; do
    if [ `pg_status | grep -c "server is running"` -gt 0 ]; then
      echo "Done."
      cycle=0
    else
      if [ "$cycle" -eq 1 ]; then
        echo "FogLAMP cannot be initialized."
        exit 3
      else
        echo -n "."
        cycle=$((cycle -1))
        sleep 1
      fi
    fi
  done

fi

exit 0
